<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SlumLink | Complaint Categories</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --sand:#CBB093;
  --sand2:#E0C7AC;
  --paper:#FFF4E6;
  --terra:#A4624D;
  --ink:#613729;
  --warning:#E8A444;
  --header-h:56px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Poppins", sans-serif;
  background: linear-gradient(116.82deg,#CBB093 21.58%,#E0C7AC 31.36%,#F8E5CF 50.73%,#C0E0D0 71.52%);
  color: var(--ink);
  min-height:100vh;
  overflow-x:hidden;
}
.topbar{
  position:fixed; top:0; left:0; right:0;
  height:56px; background:var(--paper);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 70px; z-index:50;
}
.brand{display:flex;align-items:center;gap:10px;cursor:pointer;}
.brand-mark{width:32px;height:32px;border-radius:14px;background:linear-gradient(143deg, rgba(164,98,77,.75), rgba(223,164,119,.75));}
.brand-text{font-size:20px;font-weight:500;color:rgba(164,98,77,.86);}
.pill-btn{height:34px;padding:0 14px;border-radius:14px;font-weight:700;font-size:14px;border:1px solid rgba(97,55,41,.14);background:rgba(255,244,230,.85);color:rgba(97,55,41,.78);display:flex;align-items:center;gap:8px;cursor:pointer;position:relative;}
.alert-badge{position:absolute;top:-6px;right:-10px;background:var(--warning);color:#fff;min-width:26px;height:26px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px;padding:0 8px;}
.container{max-width:1440px;margin:82px auto 50px;padding:0 40px;}
.page-title{font-size:40px;font-weight:700;margin-top:60px;margin-bottom:12px;}
.page-subtitle{font-size:24px;font-weight:300;margin-bottom:40px;max-width:1200px;}
.categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:30px;margin-bottom:80px;}
.category-card{background:var(--paper);border:1px solid var(--sand);border-radius:18px;box-shadow:5px 5px 4px rgba(173,117,98,0.24);height:180px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:24px;font-weight:600;cursor:pointer;position:relative;padding:10px;}
.category-card .count{position:absolute;top:12px;right:16px;font-size:16px;color:var(--terra);}
</style>
</head>

<body>

<header class="topbar">
  <div class="brand" id="brandBtn">
    <img src="/src/images/slum Logo.png" class="brand-mark"/>
    <div class="brand-text">SLUMLINK</div>
  </div>

  <button class="pill-btn" id="backBtn">
    <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
  </button>
</header>


<main class="container">
  <h1 class="page-title">Complaint Checking</h1>
  <p class="page-subtitle">
    Complaints are categorized using predefined administrative domains.
  </p>

  <div class="categories-grid">
    <div class="category-card" data-category="Water Supply">Water Supply <span class="count"></span></div>
    <div class="category-card" data-category="Sanitation">Sanitation <span class="count"></span></div>
    <div class="category-card" data-category="Electricity">Electricity <span class="count"></span></div>
    <div class="category-card" data-category="Street Lighting">Street Lighting <span class="count"></span></div>
    <div class="category-card" data-category="Waste Management">Waste Management <span class="count"></span></div>
    <div class="category-card" data-category="Health Services">Health Services <span class="count"></span></div>
    <div class="category-card" data-category="Education Facilities">Education Facilities <span class="count"></span></div>
    <div class="category-card" data-category="Road Maintenance">Road Maintenance <span class="count"></span></div>
    <div class="category-card" data-category="Safety & Security">Safety & Security <span class="count"></span></div>
    <div class="category-card" data-category="Housing">Housing <span class="count"></span></div>
    <div class="category-card" data-category="Flooding & Drainage">Flooding & Drainage <span class="count"></span></div>
    <div class="category-card" data-category="Public Transport">Public Transport <span class="count"></span></div>
    <div class="category-card" data-category="Others">Others <span class="count"></span></div>
  </div>
</main>

<script>
brandBtn.onclick = () => location.href = "/";
document.getElementById("backBtn").onclick = () => location.href = "./local-dashboard.html";

async function fetchComplaintCounts(){
  try{
    // Get division from localStorage session
    const sessionRaw = localStorage.getItem("SLUMLINK_SESSION");
    const session = sessionRaw ? JSON.parse(sessionRaw) : {};
    const division = session.division || "";
    
    // Build URL with division parameter
    let url = "/api/complaints/counts";
    if (division) {
      url += `?division=${encodeURIComponent(division)}`;
    }
    
    const res = await fetch(url);
    const data = await res.json();
    const categories = data.categories || {};

    document.querySelectorAll(".category-card").forEach(card=>{
      const cat = card.dataset.category;
      card.querySelector(".count").textContent = `(${categories[cat] || 0})`;

      // Go to complaints page for that category, passing division
      card.onclick = () => {
        const url = `/src/localauthority/complaints.html?category=${encodeURIComponent(cat)}`;
        window.location.href = url;
      };
    });
  }catch(err){console.error(err);}
}

fetchComplaintCounts();
</script>
</body>
</html>
