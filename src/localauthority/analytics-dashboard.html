<!-- localauthority/analytics-dashboard.html (UPDATED: Figma panel tint + only Back button + single stable chart) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SlumLink | Analytics Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --sand:#CBB093;
      --sand2:#DAC4AD;
      --paper:#FFF4E6;
      --terra:#A4624D;     /* figma stop 1 */
      --peach:#DFA477;     /* figma stop 2 */
      --ink:#613729;

      --header-h:56px;
      --radius-lg:26px;
      --radius-md:18px;

      --border: rgba(97, 55, 41, 0.18);
      --shadowCard: 0 10px 24px rgba(97, 55, 41, 0.10);
      --shadowHover: 0 16px 36px rgba(97, 55, 41, 0.14);

      --transition: all 0.28s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    *{ box-sizing:border-box; margin:0; }
    html,body{ height:100%; }

    body{
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--ink);
      background: linear-gradient(
        to bottom right,
        #CBB093 0%,
        #CBB093 22%,
        #DAC4AD 45%,
        #C0E0D0 76%,
        #C0E0D0 100%
      );
      background-attachment: fixed;
      overflow-x:hidden;
      padding-bottom: 72px;
    }

    /* ===== Header ===== */
    .topbar{
      position: fixed;
      inset: 0 0 auto 0;
      height: var(--header-h);
      z-index: 50;

      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 73px 0 70px;

      background: #FFF4E6;
      border-bottom: none;
      box-shadow: none;
    }

    .brand{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      cursor:pointer;
      transition: var(--transition);
      user-select:none;
    }
    .brand:hover{ transform: translateY(-1px); }

    .brand-mark{
      width: 32px; height: 32px;
      border-radius: 14px;
      background: linear-gradient(143.48deg, rgba(164, 98, 77, 0.75) 38.34%, rgba(223, 164, 119, 0.75) 78.43%);
    }

    .brand-text{
      font-weight: 500;
      font-size: 20px;
      color: rgba(164, 98, 77, 0.86);
      text-transform: uppercase;
      line-height: 1;
      white-space: nowrap;
      letter-spacing: 0.04em;
    }

    .pill-btn{
      height: 34px;
      padding: 0 14px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      cursor:pointer;
      border: 1px solid rgba(97,55,41,0.14);
      background: rgba(255,244,230,0.85);
      color: rgba(97,55,41,0.78);
      transition: var(--transition);
      display:inline-flex;
      align-items:center;
      gap: 8px;
      white-space: nowrap;
    }
    .pill-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(97,55,41,0.22);
      color: rgba(97,55,41,0.92);
      box-shadow: 0 10px 18px rgba(97,55,41,0.10);
    }
    .pill-btn:active{ transform: translateY(0); }

    /* ===== Layout ===== */
    .container{
      max-width: 1360px;
      margin: calc(var(--header-h) + 26px) auto 52px;
      padding: 0 28px;
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    .hero{
      background: rgba(255, 244, 230, 0.94);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadowCard);
      padding: 26px 30px;
      position: relative;
      overflow:hidden;
    }

    .hero h1{
      font-size: 44px;
      font-weight: 800;
      letter-spacing: -0.02em;
      color: rgba(47,34,32,0.90);
      margin-bottom: 8px;
      line-height: 1.1;
    }

    .hero p{
      font-size: 16px;
      font-weight: 600;
      color: rgba(97, 55, 41, 0.62);
      max-width: 760px;
    }

    /* ✅ BIG PANEL: use your figma "little upper layer" tint */
    .report-panel{
      background: linear-gradient(
        135deg,
        rgba(164,98,77,0.34),
        rgba(223,164,119,0.34)
      );
      border: 1px solid rgba(97,55,41,0.22);
      border-radius: 40px; /* matches your figma radius 40 */
      box-shadow: 0 18px 40px rgba(97,55,41,0.14);
      overflow:hidden;
    }

    .report-inner{
      padding: 28px;
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    .top-row{
      display:grid;
      grid-template-columns: 1.1fr 1fr 1fr;
      gap: 18px;
      align-items: start;
    }

    .card{
      border-radius: 22px;
      background: rgba(255,244,230,0.92);
      border: 1px solid rgba(97,55,41,0.18);
      box-shadow: 0 10px 24px rgba(97,55,41,0.10);
      padding: 20px;
    }

    .card-title{
      font-size: 20px;
      font-weight: 800;
      color: rgba(97,55,41,0.70);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 14px;
    }

    .select-wrap{
      position: relative;
    }

    select{
      width: 100%;
      height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(97,55,41,0.18);
      background: rgba(255,255,255,0.55);
      padding: 0 44px 0 14px;
      font-weight: 700;
      font-size: 15px;
      color: rgba(47,34,32,0.86);
      outline: none;
      appearance: none;
      transition: var(--transition);
    }

    select:focus{
      border-color: rgba(164,98,77,0.30);
      box-shadow: 0 12px 24px rgba(164,98,77,0.10);
    }

    .select-ic{
      position:absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events:none;
      color: rgba(97,55,41,0.70);
      font-size: 16px;
    }

    .metric{
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      gap: 8px;
      min-height: 130px;
    }

    .metric-num{
      font-size: 44px;
      font-weight: 900;
      color: rgba(47,34,32,0.86);
      letter-spacing: -0.02em;
      line-height: 1;
    }

    .metric-label{
      font-size: 18px;
      font-weight: 800;
      color: rgba(97,55,41,0.64);
      letter-spacing: 0.10em;
      text-transform: uppercase;
    }

    /* ===== Chart area (only one) ===== */
    .chart-card{
      border-radius: 22px;
      background: rgba(255,244,230,0.92);
      border: 1px solid rgba(97,55,41,0.18);
      box-shadow: 0 10px 24px rgba(97,55,41,0.10);
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height: 330px;
    }

    .chart-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .chart-head h3{
      font-size: 16px;
      font-weight: 900;
      color: rgba(47,34,32,0.86);
    }

    .chip{
      font-size: 12px;
      font-weight: 900;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(97,55,41,0.14);
      background: rgba(223,164,119,0.14);
      color: rgba(97,55,41,0.78);
      white-space: nowrap;
    }

    .chart-wrap{
      height: 260px; /* fixed height so it never grows */
      width: 100%;
    }
    .chart-wrap canvas{
      width: 100% !important;
      height: 100% !important;
      display:block;
    }

    .hint{
      font-size: 13px;
      font-weight: 700;
      color: rgba(97,55,41,0.62);
      line-height: 1.55;
    }

    .disabled{
      opacity: 0.55;
      pointer-events: none;
      user-select: none;
    }

    /* Responsive */
    @media (max-width: 1180px){
      .top-row{ grid-template-columns: 1fr; }
      .hero h1{ font-size: 36px; }
      .topbar{ padding: 0 16px; }
    }

    @media (max-width: 680px){
      .container{ padding: 0 16px; }
      .hero{ padding: 22px 18px; }
      .hero h1{ font-size: 30px; }
      .pill-btn{ height: 32px; font-size: 13px; padding: 0 12px; border-radius: 13px; }
      .metric-num{ font-size: 38px; }
      .metric-label{ font-size: 16px; }
      .report-inner{ padding: 18px; }
    }
  </style>
</head>

<body>
  <header class="topbar" aria-label="Header">
    <div class="brand" id="brandBtn" aria-label="SlumLink Home" role="button" tabindex="0">
      <span class="brand-mark" aria-hidden="true"></span>
      <div class="brand-text">SLUMLINK</div>
    </div>

    <!-- ✅ ONLY Back button (Logout removed) -->
    <button class="pill-btn" id="backBtn" type="button" aria-label="Back to dashboard">
      <i class="fas fa-arrow-left" aria-hidden="true"></i>
      <span>Back to Dashboard</span>
    </button>
  </header>

  <main class="container">
    <section class="hero" aria-label="Analytics intro">
      <h1>One step away from a full-fledged report</h1>
      <p>Select a slum area to generate a graphical report.</p>
    </section>

    <section class="report-panel" aria-label="Report panel">
      <div class="report-inner">
        <div class="top-row">
          <div class="card">
            <div class="card-title">TARGET SLUM AREA</div>
            <div class="select-wrap">
              <select id="slumSelect" aria-label="Select slum area">
                <option value="">Select</option>
                <option value="korail">Korail</option>
                <option value="mirpur">Mirpur</option>
                <option value="rampura">Rampura</option>
                <option value="kamrangirchar">Kamrangirchar</option>
              </select>
              <i class="fas fa-chevron-down select-ic" aria-hidden="true"></i>
            </div>
            <p class="hint" style="margin-top:12px;">
              You’ll get one simple report: category-wise people helped + impact percentage inside that slum.
            </p>
          </div>

          <div class="card metric" aria-label="People helped">
            <div class="metric-num" id="peopleHelped">—</div>
            <div class="metric-label">PEOPLE HELPED</div>
          </div>

          <div class="card metric" aria-label="Campaigns">
            <div class="metric-num" id="campaignCount">—</div>
            <div class="metric-label">CAMPAIGNS</div>
          </div>

          <div class="card metric" aria-label="Complaints Solved">
            <div class="metric-num" id="complaintsSolved">—</div>
            <div class="metric-label">COMPLAINTS SOLVED</div>
          </div>

          <div class="card metric" aria-label="Complaints Pending">
            <div class="metric-num" id="complaintsPending">—</div>
            <div class="metric-label">COMPLAINTS PENDING</div>
          </div>

          <div class="card metric" aria-label="Complaints In Progress">
            <div class="metric-num" id="complaintsInProgress">—</div>
            <div class="metric-label">IN PROGRESS</div>
          </div>
        </div>

        <div class="chart-card disabled" id="chartCard" aria-label="Impact chart">
          <div class="chart-head">
            <h3>Impact by Category (People Helped)</h3>
            <span class="chip" id="slumChip">Select a slum</span>
          </div>

          <div class="chart-wrap">
            <canvas id="impactChart"></canvas>
          </div>

          <p class="hint" id="impactHint">
            Select a slum area to generate the chart.
          </p>
        </div>

        <div class="chart-card disabled" id="trendCard" aria-label="Trend chart">
          <div class="chart-head">
            <h3>Complaints Trend</h3>
            <span class="chip" id="trendChip">Select a slum</span>
          </div>

          <div class="chart-wrap">
            <canvas id="trendChart"></canvas>
          </div>

          <p class="hint" id="trendHint">
            Select a slum area to view monthly complaint trends.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ✅ Simple sample data (replace later with DB)
    // Categories that match SlumLink NGO concept:
    // Food, Health, Education, Shelter, Water & Sanitation
    const DATA = {
      korail: {
        name: "Korail",
        peopleHelped: 13240,
        campaigns: 42,
        complaintsSolved: 156,
        complaintsPending: 23,
        complaintsInProgress: 18,
        complaintsTrend: 12,
        monthlyTrend: [45, 52, 48, 61, 58, 72, 68, 75, 82, 88, 95, 102], // Jan-Dec
        categories: {
          Food: 3200,
          Health: 2800,
          Education: 2300,
          Shelter: 2100,
          "Water & Sanitation": 2840
        }
      },
      mirpur: {
        name: "Mirpur",
        peopleHelped: 9840,
        campaigns: 31,
        complaintsSolved: 98,
        complaintsPending: 15,
        complaintsInProgress: 12,
        complaintsTrend: -8,
        monthlyTrend: [38, 42, 45, 41, 44, 48, 45, 42, 40, 38, 35, 32], // Jan-Dec
        categories: {
          Food: 2400,
          Health: 2100,
          Education: 1800,
          Shelter: 1400,
          "Water & Sanitation": 2140
        }
      },
      rampura: {
        name: "Rampura",
        peopleHelped: 7650,
        campaigns: 24,
        complaintsSolved: 72,
        complaintsPending: 9,
        complaintsInProgress: 7,
        complaintsTrend: 5,
        monthlyTrend: [28, 30, 32, 35, 36, 38, 40, 42, 44, 45, 47, 48], // Jan-Dec
        categories: {
          Food: 1700,
          Health: 1600,
          Education: 1500,
          Shelter: 1200,
          "Water & Sanitation": 1650
        }
      },
      kamrangirchar: {
        name: "Kamrangirchar",
        peopleHelped: 11420,
        campaigns: 37,
        complaintsSolved: 134,
        complaintsPending: 19,
        complaintsInProgress: 14,
        complaintsTrend: 20,
        monthlyTrend: [55, 62, 58, 70, 75, 85, 92, 98, 105, 112, 120, 128], // Jan-Dec
        categories: {
          Food: 2800,
          Health: 2400,
          Education: 2100,
          Shelter: 1600,
          "Water & Sanitation": 2520
        }
      }
    };

    const slumSelect = document.getElementById("slumSelect");
    const peopleEl = document.getElementById("peopleHelped");
    const campEl = document.getElementById("campaignCount");
    const complaintsSolvedEl = document.getElementById("complaintsSolved");
    const complaintsPendingEl = document.getElementById("complaintsPending");
    const complaintsInProgressEl = document.getElementById("complaintsInProgress");
    const chartCard = document.getElementById("chartCard");
    const trendCard = document.getElementById("trendCard");
    const slumChip = document.getElementById("slumChip");
    const trendChip = document.getElementById("trendChip");
    const impactHint = document.getElementById("impactHint");
    const trendHint = document.getElementById("trendHint");

    function formatNumber(n){
      return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function formatTrend(value){
      if(value > 0){
        return `<span style="color: #e74c3c;">↑ ${value}%</span>`;
      } else if(value < 0){
        return `<span style="color: #27ae60;">↓ ${Math.abs(value)}%</span>`;
      } else {
        return `<span style="color: #95a5a6;">→ 0%</span>`;
      }
    }

    // ✅ TWO chart instances
    let chartInstance = null;
    let trendChartInstance = null;

    function renderChartFor(key){
      const d = DATA[key];
      
      // Update complaints metrics
      complaintsSolvedEl.textContent = formatNumber(d.complaintsSolved);
      complaintsPendingEl.textContent = formatNumber(d.complaintsPending);
      complaintsInProgressEl.textContent = formatNumber(d.complaintsInProgress);
      
      const labels = Object.keys(d.categories);
      const values = Object.values(d.categories);
      const total = values.reduce((a,b)=>a+b,0);

      // Build % labels for tooltip
      const percentOf = (v) => Math.round((v / total) * 100);

      // Destroy old chart properly
      if(chartInstance){
        chartInstance.destroy();
        chartInstance = null;
      }

      const ctx = document.getElementById("impactChart").getContext("2d");

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "People helped",
            data: values,
            borderWidth: 0,
            borderRadius: 12,
            backgroundColor: "rgba(223, 164, 119, 0.8)"
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (c) => {
                  const v = c.parsed.y;
                  return ` ${formatNumber(v)} people (${percentOf(v)}%)`;
                }
              }
            }
          },
          scales: {
            x: { grid: { display: false } },
            y: {
              beginAtZero: true,
              ticks: { callback: (v) => formatNumber(v) }
            }
          }
        }
      });

      // Render trend chart
      renderTrendChartFor(key);

      slumChip.textContent = d.name;
      trendChip.textContent = d.name;
    }

    function renderTrendChartFor(key){
      const d = DATA[key];
      const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      const trendData = d.monthlyTrend;

      // Calculate if trend is up or down
      const firstHalf = trendData.slice(0, 6).reduce((a, b) => a + b) / 6;
      const secondHalf = trendData.slice(6, 12).reduce((a, b) => a + b) / 6;
      const isIncreasing = secondHalf >= firstHalf;

      // Destroy old trend chart
      if(trendChartInstance){
        trendChartInstance.destroy();
        trendChartInstance = null;
      }

      const trendCtx = document.getElementById("trendChart").getContext("2d");

      trendChartInstance = new Chart(trendCtx, {
        type: "line",
        data: {
          labels: months,
          datasets: [{
            label: "Monthly Complaints",
            data: trendData,
            borderColor: isIncreasing ? "#e74c3c" : "#27ae60",
            backgroundColor: isIncreasing ? "rgba(231, 76, 60, 0.08)" : "rgba(39, 174, 96, 0.08)",
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointBackgroundColor: isIncreasing ? "#e74c3c" : "#27ae60",
            pointBorderColor: "#fff",
            pointBorderWidth: 2,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: true, position: "bottom" },
            tooltip: {
              backgroundColor: "rgba(97, 55, 41, 0.9)",
              padding: 12,
              titleFont: { size: 14, weight: "bold" },
              bodyFont: { size: 13 },
              callbacks: {
                label: (c) => {
                  const v = c.parsed.y;
                  return ` Complaints: ${v}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { callback: (v) => v }
            }
          }
        }
      });
    }

    slumSelect.addEventListener("change", ()=>{
      const key = slumSelect.value;

      if(!key){
        peopleEl.textContent = "—";
        campEl.textContent = "—";
        complaintsSolvedEl.textContent = "—";
        complaintsPendingEl.textContent = "—";
        complaintsInProgressEl.textContent = "—";
        chartCard.classList.add("disabled");
        trendCard.classList.add("disabled");
        slumChip.textContent = "Select a slum";
        trendChip.textContent = "Select a slum";
        impactHint.textContent = "Select a slum area to generate the chart.";
        trendHint.textContent = "Select a slum area to view monthly complaint trends.";
        if(chartInstance){ chartInstance.destroy(); chartInstance = null; }
        if(trendChartInstance){ trendChartInstance.destroy(); trendChartInstance = null; }
        return;
      }

      const d = DATA[key];
      peopleEl.textContent = formatNumber(d.peopleHelped);
      campEl.textContent = formatNumber(d.campaigns);
      chartCard.classList.remove("disabled");
      trendCard.classList.remove("disabled");

      renderChartFor(key);
    });

    // Header actions
    const brandBtn = document.getElementById("brandBtn");
    const backBtn = document.getElementById("backBtn");

    function goHome(){ window.location.href = "/"; }
    brandBtn.addEventListener("click", goHome);
    brandBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); goHome(); } });

    // Back to Local Authority dashboard
    backBtn.addEventListener("click", ()=>{
      window.location.href = "./local-dashboard.html";
    });
  </script>
</body>
</html>
