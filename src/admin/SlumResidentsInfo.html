<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SLUMLINK ¬∑ Resident Information</title>
  <link rel="stylesheet" href="adminSlumAnalytics.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .info-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .info-section h3 {
      margin-top: 0;
      color: #7D5A3B;
      border-bottom: 2px solid #7D5A3B;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .info-item {
      display: flex;
      flex-direction: column;
    }
    .info-label {
      font-weight: 600;
      color: #555;
      font-size: 0.9em;
      margin-bottom: 5px;
    }
    .info-value {
      color: #333;
      padding: 8px;
      background: #f5f5f5;
      border-radius: 4px;
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #7D5A3B 0%, #9B8066 100%);
      border-radius: 8px;
      color: white;
    }
    .profile-header-info h2 {
      margin: 0 0 5px 0;
    }
    .profile-header-info p {
      margin: 0;
      opacity: 0.9;
    }
    .doc-preview {
      max-width: 150px;
      border-radius: 4px;
      cursor: pointer;
      border: 2px solid #ddd;
      transition: border-color 0.3s;
    }
    .doc-preview:hover {
      border-color: #7D5A3B;
    }
    .new-docs-badge {
      background: #ff6b6b;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      margin-left: 10px;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .subsection {
      margin-top: 15px;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #7D5A3B;
      border-radius: 4px;
    }
    .subsection h4 {
      margin-top: 0;
      color: #7D5A3B;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="logo">SLUMLINK</div>
    <input type="text" placeholder="Search" class="search" />
    <div class="top-right">
      <div class="admin">
        <span>Admin ‚ñæ</span>
        <div class="admin-dropdown">
          <button class="admin-logout">Logout</button>
        </div>
      </div>
      <a class="bell" href="adminNotification.html" title="Notifications">üîî</a>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <ul>
        <li><a href="adminSlumAnalytics.html">üìä Slum Analytics</a></li>
        <li><a href="adminNgoAnalytics.html">üìà NGO Analytics</a></li>
        <li class="active"><a href="adminSlumResidents.html">üè† Slum Residents</a></li>
        <li><a href="adminFieldAgents.html">üßë‚Äçüíº Field Agents</a></li>
        <li><a href="adminVerifyNgo.html">‚úî Verify NGOs</a></li>
      </ul>
    </aside>

    <main class="content">
      <div class="profile-header">
        <div class="profile-header-info">
          <h2 id="residentName">Loading...</h2>
          <p><strong>ID:</strong> <span id="residentId">-</span> | <strong>Slum:</strong> <span id="residentSlum">-</span></p>
          <span id="newDocsBadge" class="new-docs-badge" style="display: none;">New Documents Pending</span>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="info-section">
        <h3>Personal Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Full Name</span>
            <span class="info-value" id="fullName">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Date of Birth</span>
            <span class="info-value" id="dob">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Gender</span>
            <span class="info-value" id="gender">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">NID Number</span>
            <span class="info-value" id="nid">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Education</span>
            <span class="info-value" id="education">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Occupation</span>
            <span class="info-value" id="occupation">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Income</span>
            <span class="info-value" id="income">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Mobile Number</span>
            <span class="info-value" id="mobile">-</span>
          </div>
        </div>
      </div>

      <!-- Location Information -->
      <div class="info-section">
        <h3>Location Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Area</span>
            <span class="info-value" id="area">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">District</span>
            <span class="info-value" id="district">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Division</span>
            <span class="info-value" id="division">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Number of Family Members</span>
            <span class="info-value" id="familyMembers">-</span>
          </div>
        </div>
      </div>

      <!-- Marital Information -->
      <div class="info-section">
        <h3>Marital Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Marital Status</span>
            <span class="info-value" id="maritalStatus">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">Number of Spouse</span>
            <span class="info-value" id="numSpouse">-</span>
          </div>
        </div>

        <div id="spouseContainer"></div>
      </div>

      <!-- Children Information -->
      <div class="info-section">
        <h3>Children Information</h3>
        <div class="info-item" style="margin-bottom: 15px;">
          <span class="info-label">Number of Children</span>
          <span class="info-value" id="numChildren">-</span>
        </div>

        <div id="childrenContainer"></div>
      </div>

      <!-- New Documents Section (Only for accounts with new documents) -->
      <div class="info-section" id="newDocsSection" style="display: none;">
        <h3>New Documents Submitted <span class="new-docs-badge" style="margin-left: 10px;">Pending Review</span></h3>
        <div class="info-grid">
          <div class="info-item" id="birthCertContainer" style="display: none;">
            <span class="info-label">Birth Certificate</span>
            <img id="birthCert" src="" alt="Birth Certificate" class="doc-preview">
          </div>
          <div class="info-item" id="deathCertContainer" style="display: none;">
            <span class="info-label">Death Certificate</span>
            <img id="deathCert" src="" alt="Death Certificate" class="doc-preview">
          </div>
          <div class="info-item" id="marriageCertContainer" style="display: none;">
            <span class="info-label">Marriage Certificate</span>
            <img id="marriageCert" src="" alt="Marriage Certificate" class="doc-preview">
          </div>
        </div>

        <div class="action-buttons" id="docActionButtons">
          <button class="btn btn-primary" id="approveDocsBtn">Approve Documents</button>
          <button class="btn btn-secondary" id="rejectDocsBtn">Reject Documents</button>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" id="generateReportBtn">üìÑ Generate Report</button>
        <button class="btn btn-secondary" onclick="history.back()">‚Üê Go Back</button>
      </div>
    </main>
  </div>

  <!-- Image Modal -->
  <div class="modal-overlay" id="imageModal" aria-hidden="true">
    <div class="image-modal" role="dialog" aria-modal="true">
      <button class="close-image-modal" id="closeImageModal" aria-label="Close">&times;</button>
      <img id="modalImage" src="" alt="Document preview">
      <div class="image-caption" id="imageCaption"></div>
    </div>
  </div>

  <!-- Approve Modal -->
  <div class="modal-overlay" id="approveModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Approve Documents</div>
      <div class="modal-body">Are you sure you want to approve these documents?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelApprove">Cancel</button>
        <button class="btn btn-primary" id="confirmApprove">Approve</button>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div class="modal-overlay" id="rejectModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Reject Documents</div>
      <div class="modal-body">Are you sure you want to reject these documents?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelReject">Cancel</button>
        <button class="btn btn-secondary" id="confirmReject">Reject</button>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal-overlay" id="successModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Success</div>
      <div class="modal-body" id="successModalBody"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="closeSuccess">OK</button>
      </div>
    </div>
  </div>

  <script src="adminSlumAnalytics.js"></script>
  <script>
    // Sample resident data
    var residentsData = {
      'SR001': {
        id: 'SR001',
        name: 'Rahim Ahmed',
        slum: 'Molla',
        profile: '',
        dob: '15-03-1985',
        gender: 'Male',
        nid: '19850315123456789',
        education: 'SSC',
        occupation: 'Rickshaw Puller',
        income: '‡ß≥8,000 - ‡ß≥12,000',
        mobile: '01712345678',
        area: 'Mohammadpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 5,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Salma Khatun',
            dob: '20-07-1988',
            gender: 'Female',
            nid: '19880720987654321',
            education: 'JSC',
            occupation: 'Housewife',
            income: 'N/A',
            mobile: '01798765432',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 2,
        children: [
          {
            name: 'Aisha Ahmed',
            dob: '10-05-2010',
            gender: 'Female',
            education: 'Class 8',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Teacher',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Kamal Ahmed',
            dob: '25-11-2015',
            gender: 'Male',
            education: 'Class 3',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Doctor',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: 'profilepic/birthcertificate.jpg',
        deathCert: null,
        marriageCert: null
      },
      'SR002': {
        id: 'SR002',
        name: 'Fatima Begum',
        slum: 'Korail',
        profile: '',
        dob: '22-08-1990',
        gender: 'Female',
        nid: '19900822567891234',
        education: 'HSC',
        occupation: 'Garment Worker',
        income: '‡ß≥10,000 - ‡ß≥15,000',
        mobile: '01823456789',
        area: 'Banani',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 4,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Hafiz Rahman',
            dob: '15-02-1987',
            gender: 'Male',
            nid: '19870215456789123',
            education: 'SSC',
            occupation: 'Shop Owner',
            income: '‡ß≥12,000 - ‡ß≥18,000',
            mobile: '01934567890',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 1,
        children: [
          {
            name: 'Nusrat Rahman',
            dob: '05-12-2012',
            gender: 'Female',
            education: 'Class 6',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Nurse',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: null,
        deathCert: null,
        marriageCert: 'profilepic/marraigeertificate.png'
      },
      'SR003': {
        id: 'SR003',
        name: 'Karim Hossain',
        slum: 'Begun Bari',
        profile: '',
        dob: '30-01-1978',
        gender: 'Male',
        nid: '19780130234567890',
        education: 'Class 8',
        occupation: 'Day Laborer',
        income: '‡ß≥6,000 - ‡ß≥10,000',
        mobile: '01645678901',
        area: 'Tejgaon',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 6,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Razia Sultana',
            dob: '12-06-1982',
            gender: 'Female',
            nid: '19820612345678901',
            education: 'Class 5',
            occupation: 'Housemaid',
            income: '‡ß≥5,000 - ‡ß≥8,000',
            mobile: '01756789012',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 3,
        children: [
          {
            name: 'Shakib Hossain',
            dob: '18-03-2008',
            gender: 'Male',
            education: 'Class 10',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Mechanic',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Taslima Hossain',
            dob: '22-09-2011',
            gender: 'Female',
            education: 'Class 7',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Tailor',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Rahim Hossain',
            dob: '14-04-2016',
            gender: 'Male',
            education: 'Class 2',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Police',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR004': {
        id: 'SR004',
        name: 'Salma Khatun',
        slum: 'Molla',
        profile: '',
        dob: '08-11-1992',
        gender: 'Female',
        nid: '19921108345678902',
        education: 'JSC',
        occupation: 'Domestic Worker',
        income: '‡ß≥7,000 - ‡ß≥10,000',
        mobile: '01867890123',
        area: 'Mohammadpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 3,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Rafiq Islam',
            dob: '25-04-1989',
            gender: 'Male',
            nid: '19890425678901234',
            education: 'SSC',
            occupation: 'Van Driver',
            income: '‡ß≥9,000 - ‡ß≥13,000',
            mobile: '01978901234',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 1,
        children: [
          {
            name: 'Nadia Islam',
            dob: '12-08-2014',
            gender: 'Female',
            education: 'Class 4',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Teacher',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: null,
        deathCert: 'profilepic/birthcertificate.jpg',
        marriageCert: null
      },
      'SR005': {
        id: 'SR005',
        name: 'Habib Rahman',
        slum: 'Korail',
        profile: '',
        dob: '18-06-1980',
        gender: 'Male',
        nid: '19800618456789012',
        education: 'SSC',
        occupation: 'Construction Worker',
        income: '‡ß≥10,000 - ‡ß≥14,000',
        mobile: '01589012345',
        area: 'Banani',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 5,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Rokeya Begum',
            dob: '22-10-1984',
            gender: 'Female',
            nid: '19841022789012345',
            education: 'Class 8',
            occupation: 'Housewife',
            income: 'N/A',
            mobile: '01690123456',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 2,
        children: [
          {
            name: 'Fahim Rahman',
            dob: '15-03-2009',
            gender: 'Male',
            education: 'Class 9',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Engineer',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Sumaiya Rahman',
            dob: '28-07-2013',
            gender: 'Female',
            education: 'Class 5',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Doctor',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR006': {
        id: 'SR006',
        name: 'Nasima Akter',
        slum: 'DuariPara',
        profile: '',
        dob: '14-02-1986',
        gender: 'Female',
        nid: '19860214890123456',
        education: 'HSC',
        occupation: 'Garment Worker',
        income: '‡ß≥11,000 - ‡ß≥15,000',
        mobile: '01701234567',
        area: 'Mirpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 4,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Shafiq Mia',
            dob: '30-05-1983',
            gender: 'Male',
            nid: '19830530901234567',
            education: 'SSC',
            occupation: 'Small Business Owner',
            income: '‡ß≥13,000 - ‡ß≥18,000',
            mobile: '01812345678',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 2,
        children: [
          {
            name: 'Tania Mia',
            dob: '20-11-2011',
            gender: 'Female',
            education: 'Class 7',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Nurse',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Sabbir Mia',
            dob: '05-09-2015',
            gender: 'Male',
            education: 'Class 3',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Pilot',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: 'profilepic/birthcertificate.jpg',
        deathCert: null,
        marriageCert: null
      },
      'SR007': {
        id: 'SR007',
        name: 'Jahangir Alam',
        slum: 'Kallyanpur',
        profile: '',
        dob: '07-12-1975',
        gender: 'Male',
        nid: '19751207012345678',
        education: 'Class 5',
        occupation: 'Street Vendor',
        income: '‡ß≥5,000 - ‡ß≥9,000',
        mobile: '01923456789',
        area: 'Kallyanpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 7,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Ayesha Siddika',
            dob: '18-08-1979',
            gender: 'Female',
            nid: '19790818123456789',
            education: 'Class 3',
            occupation: 'Housewife',
            income: 'N/A',
            mobile: '01634567890',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 4,
        children: [
          {
            name: 'Mahbub Alam',
            dob: '10-04-2006',
            gender: 'Male',
            education: 'HSC',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Driver',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Sabina Alam',
            dob: '25-06-2010',
            gender: 'Female',
            education: 'Class 8',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Tailor',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Rubel Alam',
            dob: '12-01-2013',
            gender: 'Male',
            education: 'Class 5',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Shopkeeper',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Mitu Alam',
            dob: '08-11-2016',
            gender: 'Female',
            education: 'Class 2',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Teacher',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR008': {
        id: 'SR008',
        name: 'Roksana Sultana',
        slum: 'Begun Bari',
        profile: '',
        dob: '05-09-1988',
        gender: 'Female',
        nid: '19880905234567890',
        education: 'SSC',
        occupation: 'Factory Worker',
        income: '‡ß≥9,000 - ‡ß≥13,000',
        mobile: '01745678901',
        area: 'Tejgaon',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 3,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Jalal Uddin',
            dob: '12-03-1985',
            gender: 'Male',
            nid: '19850312345678901',
            education: 'HSC',
            occupation: 'Electrician',
            income: '‡ß≥12,000 - ‡ß≥16,000',
            mobile: '01856789012',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 1,
        children: [
          {
            name: 'Sadia Jalal',
            dob: '22-05-2013',
            gender: 'Female',
            education: 'Class 5',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Designer',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: null,
        deathCert: null,
        marriageCert: 'profilepic/marraigeertificate.png'
      },
      'SR009': {
        id: 'SR009',
        name: 'Monir Hossain',
        slum: 'Pora Basti',
        profile: '',
        dob: '28-07-1982',
        gender: 'Male',
        nid: '19820728456789012',
        education: 'Class 8',
        occupation: 'Carpenter',
        income: '‡ß≥10,000 - ‡ß≥15,000',
        mobile: '01967890123',
        area: 'Kamrangirchar',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 4,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Amina Khatun',
            dob: '15-12-1986',
            gender: 'Female',
            nid: '19861215567890123',
            education: 'JSC',
            occupation: 'Housewife',
            income: 'N/A',
            mobile: '01678901234',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 2,
        children: [
          {
            name: 'Rifat Hossain',
            dob: '10-08-2010',
            gender: 'Male',
            education: 'Class 8',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Carpenter',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Mim Hossain',
            dob: '03-02-2014',
            gender: 'Female',
            education: 'Class 4',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Teacher',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR010': {
        id: 'SR010',
        name: 'Shirin Akhter',
        slum: 'Molla',
        profile: '',
        dob: '19-04-1991',
        gender: 'Female',
        nid: '19910419678901234',
        education: 'HSC',
        occupation: 'Beauty Parlor Worker',
        income: '‡ß≥8,000 - ‡ß≥12,000',
        mobile: '01789012345',
        area: 'Mohammadpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 3,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Liton Mia',
            dob: '08-01-1988',
            gender: 'Male',
            nid: '19880108789012345',
            education: 'SSC',
            occupation: 'Mechanic',
            income: '‡ß≥11,000 - ‡ß≥15,000',
            mobile: '01890123456',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 1,
        children: [
          {
            name: 'Anisha Mia',
            dob: '16-09-2015',
            gender: 'Female',
            education: 'Class 3',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Fashion Designer',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: null,
        deathCert: null,
        marriageCert: 'profilepic/marraigeertificate.png'
      },
      'SR011': {
        id: 'SR011',
        name: 'Abdul Karim',
        slum: 'Korail',
        profile: '',
        dob: '24-10-1977',
        gender: 'Male',
        nid: '19771024890123456',
        education: 'Class 10',
        occupation: 'Security Guard',
        income: '‡ß≥9,000 - ‡ß≥12,000',
        mobile: '01901234567',
        area: 'Banani',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 5,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Rehana Begum',
            dob: '02-06-1981',
            gender: 'Female',
            nid: '19810602901234567',
            education: 'JSC',
            occupation: 'Cleaner',
            income: '‡ß≥6,000 - ‡ß≥8,000',
            mobile: '01612345678',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 3,
        children: [
          {
            name: 'Imran Karim',
            dob: '14-07-2007',
            gender: 'Male',
            education: 'Class 11',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Security Officer',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Fatema Karim',
            dob: '30-12-2011',
            gender: 'Female',
            education: 'Class 7',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Nurse',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Sohel Karim',
            dob: '18-03-2015',
            gender: 'Male',
            education: 'Class 3',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Police',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR012': {
        id: 'SR012',
        name: 'Kulsum Begum',
        slum: 'Pura',
        profile: '',
        dob: '11-05-1984',
        gender: 'Female',
        nid: '19840511012345678',
        education: 'Class 8',
        occupation: 'Housemaid',
        income: '‡ß≥7,000 - ‡ß≥10,000',
        mobile: '01723456789',
        area: 'Badda',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 6,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Aziz Mollah',
            dob: '26-09-1980',
            gender: 'Male',
            nid: '19800926123456789',
            education: 'SSC',
            occupation: 'Day Laborer',
            income: '‡ß≥8,000 - ‡ß≥11,000',
            mobile: '01834567890',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 3,
        children: [
          {
            name: 'Raihan Aziz',
            dob: '07-02-2008',
            gender: 'Male',
            education: 'Class 10',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Electrician',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Sharmin Aziz',
            dob: '21-06-2012',
            gender: 'Female',
            education: 'Class 6',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Teacher',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Tanvir Aziz',
            dob: '13-11-2016',
            gender: 'Male',
            education: 'Class 2',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Driver',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: true,
        birthCert: null,
        deathCert: 'profilepic/birthcertificate.jpg',
        marriageCert: null
      },
      'SR013': {
        id: 'SR013',
        name: 'Sumon Mia',
        slum: 'Molla',
        profile: '',
        dob: '16-07-1989',
        gender: 'Male',
        nid: '19890716123456789',
        education: 'SSC',
        occupation: 'Auto Rickshaw Driver',
        income: '‡ß≥12,000 - ‡ß≥16,000',
        mobile: '01634567890',
        area: 'Mohammadpur',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 4,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Lovely Akter',
            dob: '28-11-1992',
            gender: 'Female',
            nid: '19921128234567890',
            education: 'HSC',
            occupation: 'Garment Worker',
            income: '‡ß≥9,000 - ‡ß≥12,000',
            mobile: '01745678901',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 2,
        children: [
          {
            name: 'Riya Mia',
            dob: '12-04-2014',
            gender: 'Female',
            education: 'Class 4',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Designer',
            birthCert: 'profilepic/birthcertificate.jpg'
          },
          {
            name: 'Arman Mia',
            dob: '20-09-2017',
            gender: 'Male',
            education: 'Class 1',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Driver',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      },
      'SR014': {
        id: 'SR014',
        name: 'Amina Begum',
        slum: 'Korail',
        profile: '',
        dob: '03-03-1987',
        gender: 'Female',
        nid: '19870303345678901',
        education: 'JSC',
        occupation: 'Small Shop Owner',
        income: '‡ß≥10,000 - ‡ß≥14,000',
        mobile: '01856789012',
        area: 'Banani',
        district: 'Dhaka',
        division: 'Dhaka',
        familyMembers: 3,
        maritalStatus: 'Married',
        numSpouse: 1,
        spouses: [
          {
            name: 'Jobbar Ali',
            dob: '10-05-1984',
            gender: 'Male',
            nid: '19840510456789012',
            education: 'Class 8',
            occupation: 'Construction Worker',
            income: '‡ß≥11,000 - ‡ß≥15,000',
            mobile: '01967890123',
            marriageCert: 'profilepic/marraigeertificate.png'
          }
        ],
        numChildren: 1,
        children: [
          {
            name: 'Nusrat Ali',
            dob: '22-08-2013',
            gender: 'Female',
            education: 'Class 5',
            occupation: 'Student',
            income: 'N/A',
            preferredJob: 'Businesswoman',
            birthCert: 'profilepic/birthcertificate.jpg'
          }
        ],
        hasNewDocs: false,
        birthCert: null,
        deathCert: null,
        marriageCert: null
      }
    };

    function loadResidentInfo() {
      var params = new URLSearchParams(window.location.search);
      var residentId = params.get('id');

      // First check hardcoded data
      var resident = residentsData[residentId];
      
      // If not found in hardcoded data, check localStorage for approved applications
      if (!resident) {
        try {
          var stored = localStorage.getItem('SLUMLINK_APPLICATIONS');
          if (stored) {
            var allApps = JSON.parse(stored);
            var approvedApp = allApps.find(function(app) {
              return app.status === 'approved' && (app.id === residentId || 
                (app.data && app.data.personal && app.data.personal.fullName === residentId));
            });
            
            if (approvedApp) {
              var p = approvedApp.data && approvedApp.data.personal || {};
              var m = approvedApp.data && approvedApp.data.marital || {};
              var c = approvedApp.data && approvedApp.data.children || {};
              
              resident = {
                id: approvedApp.id || residentId,
                name: p.fullName || '',
                slum: approvedApp.slum || '',
                profile: '',
                dob: p.dob || '',
                gender: p.gender || '',
                nid: p.nidNumber || '',
                education: p.education || '',
                occupation: p.occupation || '',
                income: p.income || '',
                mobile: p.mobile || '',
                area: p.area || '',
                district: p.district || '',
                division: p.division || '',
                familyMembers: p.members || 0,
                maritalStatus: m.maritalStatus || '',
                numSpouse: (m.spouses && m.spouses.length) || 0,
                spouses: m.spouses || [],
                numChildren: (c.children && c.children.length) || 0,
                children: c.children || [],
                hasNewDocs: false,
                birthCert: null,
                deathCert: null,
                marriageCert: null
              };
            }
          }
        } catch(e) { /* ignore parse errors */ }
      }

      if (!resident) {
        document.getElementById('residentName').textContent = 'Resident Not Found';
        return;
      }

      // Header
      document.getElementById('residentName').textContent = resident.name;
      document.getElementById('residentId').textContent = resident.id;
      document.getElementById('residentSlum').textContent = resident.slum;

      // Personal Info
      document.getElementById('fullName').textContent = resident.name;
      document.getElementById('dob').textContent = resident.dob;
      document.getElementById('gender').textContent = resident.gender;
      document.getElementById('nid').textContent = resident.nid;
      document.getElementById('education').textContent = resident.education;
      document.getElementById('occupation').textContent = resident.occupation;
      document.getElementById('income').textContent = resident.income;
      document.getElementById('mobile').textContent = resident.mobile;

      // Location Info
      document.getElementById('area').textContent = resident.area;
      document.getElementById('district').textContent = resident.district;
      document.getElementById('division').textContent = resident.division;
      document.getElementById('familyMembers').textContent = resident.familyMembers;

      // Marital Info
      document.getElementById('maritalStatus').textContent = resident.maritalStatus;
      document.getElementById('numSpouse').textContent = resident.numSpouse;

      // Spouses
      var spouseContainer = document.getElementById('spouseContainer');
      spouseContainer.innerHTML = '';
      if (resident.spouses && resident.spouses.length > 0) {
        resident.spouses.forEach(function(spouse, index) {
          var spouseDiv = document.createElement('div');
          spouseDiv.className = 'subsection';
          spouseDiv.innerHTML = `
            <h4>Spouse Information ${index + 1}</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Full Name</span>
                <span class="info-value">${spouse.name}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Date of Birth</span>
                <span class="info-value">${spouse.dob}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Gender</span>
                <span class="info-value">${spouse.gender}</span>
              </div>
              <div class="info-item">
                <span class="info-label">NID Number</span>
                <span class="info-value">${spouse.nid}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Education</span>
                <span class="info-value">${spouse.education}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Occupation</span>
                <span class="info-value">${spouse.occupation}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Income Range</span>
                <span class="info-value">${spouse.income}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Mobile Number</span>
                <span class="info-value">${spouse.mobile}</span>
              </div>
            </div>
            ${spouse.marriageCert ? `
              <div class="info-item" style="margin-top: 10px;">
                <span class="info-label">Marriage Certificate</span>
                <img src="${spouse.marriageCert}" alt="Marriage Certificate" class="doc-preview" onclick="openImageModal('${spouse.marriageCert}', 'Marriage Certificate - ${spouse.name}')">
              </div>
            ` : ''}
          `;
          spouseContainer.appendChild(spouseDiv);
        });
      }

      // Children
      document.getElementById('numChildren').textContent = resident.numChildren;
      var childrenContainer = document.getElementById('childrenContainer');
      childrenContainer.innerHTML = '';
      if (resident.children && resident.children.length > 0) {
        resident.children.forEach(function(child, index) {
          var childDiv = document.createElement('div');
          childDiv.className = 'subsection';
          childDiv.innerHTML = `
            <h4>Children Information ${index + 1}</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Full Name</span>
                <span class="info-value">${child.name}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Date of Birth</span>
                <span class="info-value">${child.dob}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Gender</span>
                <span class="info-value">${child.gender}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Education</span>
                <span class="info-value">${child.education}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Occupation</span>
                <span class="info-value">${child.occupation}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Income Range</span>
                <span class="info-value">${child.income}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Preferred Job</span>
                <span class="info-value">${child.preferredJob}</span>
              </div>
            </div>
            ${child.birthCert ? `
              <div class="info-item" style="margin-top: 10px;">
                <span class="info-label">Birth Certificate</span>
                <img src="${child.birthCert}" alt="Birth Certificate" class="doc-preview" onclick="openImageModal('${child.birthCert}', 'Birth Certificate - ${child.name}')">
              </div>
            ` : ''}
          `;
          childrenContainer.appendChild(childDiv);
        });
      }

      // New Documents
      if (resident.hasNewDocs) {
        document.getElementById('newDocsBadge').style.display = 'inline-block';
        document.getElementById('newDocsSection').style.display = 'block';
        
        if (resident.birthCert) {
          document.getElementById('birthCertContainer').style.display = 'block';
          var birthImg = document.getElementById('birthCert');
          birthImg.src = resident.birthCert;
          birthImg.onclick = function() {
            openImageModal(resident.birthCert, 'Birth Certificate - ' + resident.name);
          };
        }
        
        if (resident.deathCert) {
          document.getElementById('deathCertContainer').style.display = 'block';
          var deathImg = document.getElementById('deathCert');
          deathImg.src = resident.deathCert;
          deathImg.onclick = function() {
            openImageModal(resident.deathCert, 'Death Certificate - ' + resident.name);
          };
        }
        
        if (resident.marriageCert) {
          document.getElementById('marriageCertContainer').style.display = 'block';
          var marriageImg = document.getElementById('marriageCert');
          marriageImg.src = resident.marriageCert;
          marriageImg.onclick = function() {
            openImageModal(resident.marriageCert, 'Marriage Certificate - ' + resident.name);
          };
        }
      }
    }

    function openImageModal(src, caption) {
      var modal = document.getElementById('imageModal');
      var img = document.getElementById('modalImage');
      var captionEl = document.getElementById('imageCaption');
      img.src = src;
      captionEl.textContent = caption || '';
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeImageModal() {
      var modal = document.getElementById('imageModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    }

    function showSuccessModal(message) {
      var modal = document.getElementById('successModal');
      document.getElementById('successModalBody').textContent = message;
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeSuccessModal() {
      var modal = document.getElementById('successModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    }

    // Event Listeners
    document.getElementById('closeImageModal').addEventListener('click', closeImageModal);
    document.getElementById('imageModal').addEventListener('click', function(e) {
      if (e.target === this) closeImageModal();
    });

    document.getElementById('approveDocsBtn').addEventListener('click', function() {
      var modal = document.getElementById('approveModal');
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    });

    document.getElementById('rejectDocsBtn').addEventListener('click', function() {
      var modal = document.getElementById('rejectModal');
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    });

    document.getElementById('cancelApprove').addEventListener('click', function() {
      var modal = document.getElementById('approveModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    });

    document.getElementById('confirmApprove').addEventListener('click', function() {
      var modal = document.getElementById('approveModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
      showSuccessModal('Documents approved successfully!');
      setTimeout(function() {
        window.location.href = 'SlumActiveAccounts.html';
      }, 2000);
    });

    document.getElementById('cancelReject').addEventListener('click', function() {
      var modal = document.getElementById('rejectModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    });

    document.getElementById('confirmReject').addEventListener('click', function() {
      var modal = document.getElementById('rejectModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
      showSuccessModal('Documents rejected successfully!');
      setTimeout(function() {
        window.location.href = 'SlumActiveAccounts.html';
      }, 2000);
    });

    document.getElementById('approveModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.setAttribute('aria-hidden', 'true');
        this.classList.remove('show');
      }
    });

    document.getElementById('rejectModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.setAttribute('aria-hidden', 'true');
        this.classList.remove('show');
      }
    });

    document.getElementById('closeSuccess').addEventListener('click', closeSuccessModal);
    document.getElementById('successModal').addEventListener('click', function(e) {
      if (e.target === this) closeSuccessModal();
    });

    // Load data on page load
    loadResidentInfo();

    // PDF Generation
    document.getElementById('generateReportBtn').addEventListener('click', function() {
      var params = new URLSearchParams(window.location.search);
      var residentId = params.get('id');
      var resident = residentsData[residentId];

      if (!resident) {
        alert('Resident data not found');
        return;
      }

      var jsPDFCtor = (window.jspdf && window.jspdf.jsPDF) || window.jsPDF;
      if (!jsPDFCtor) { alert('PDF library not loaded'); return; }
      
      var doc = new jsPDFCtor({ unit: 'mm', format: 'a4' });
      var pageHeight = doc.internal.pageSize.getHeight();
      var pageWidth = doc.internal.pageSize.getWidth();
      var margin = 15;
      var yPosition = margin;
      var lineHeight = 7;

      // Title
      doc.setFontSize(18);
      doc.setTextColor(139, 111, 90); // Brown color
      doc.text('SLUMLINK - Resident Information Report', pageWidth / 2, yPosition, { align: 'center' });
      yPosition += 12;

      // Resident Header
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text('Resident: ' + resident.name + ' (ID: ' + resident.id + ')', margin, yPosition);
      yPosition += lineHeight;
      doc.text('Slum: ' + resident.slum, margin, yPosition);
      yPosition += 12;

      // Personal Information Section
      doc.setFontSize(11);
      doc.setTextColor(139, 111, 90);
      doc.text('Personal Information', margin, yPosition);
      yPosition += lineHeight + 2;

      doc.setFontSize(10);
      doc.setTextColor(80, 80, 80);
      var personalData = [
        ['Full Name:', resident.name],
        ['Date of Birth:', resident.dob],
        ['Gender:', resident.gender],
        ['NID Number:', resident.nid],
        ['Education:', resident.education],
        ['Occupation:', resident.occupation],
        ['Income Range:', resident.income],
        ['Mobile Number:', resident.mobile]
      ];

      personalData.forEach(function(item) {
        if (yPosition > pageHeight - 20) {
          doc.addPage();
          yPosition = margin;
        }
        doc.text(item[0], margin, yPosition);
        doc.text(item[1], margin + 50, yPosition);
        yPosition += lineHeight;
      });

      yPosition += 5;

      // Location Information Section
      doc.setFontSize(11);
      doc.setTextColor(139, 111, 90);
      doc.text('Location Information', margin, yPosition);
      yPosition += lineHeight + 2;

      doc.setFontSize(10);
      doc.setTextColor(80, 80, 80);
      var locationData = [
        ['Area:', resident.area],
        ['District:', resident.district],
        ['Division:', resident.division],
        ['Family Members:', resident.familyMembers.toString()]
      ];

      locationData.forEach(function(item) {
        if (yPosition > pageHeight - 20) {
          doc.addPage();
          yPosition = margin;
        }
        doc.text(item[0], margin, yPosition);
        doc.text(item[1], margin + 50, yPosition);
        yPosition += lineHeight;
      });

      yPosition += 5;

      // Marital Information Section
      doc.setFontSize(11);
      doc.setTextColor(139, 111, 90);
      doc.text('Marital Information', margin, yPosition);
      yPosition += lineHeight + 2;

      doc.setFontSize(10);
      doc.setTextColor(80, 80, 80);
      doc.text('Marital Status:', margin, yPosition);
      doc.text(resident.maritalStatus, margin + 50, yPosition);
      yPosition += lineHeight;
      doc.text('Number of Spouses:', margin, yPosition);
      doc.text(resident.numSpouse.toString(), margin + 50, yPosition);
      yPosition += 10;

      // Spouse Details
      if (resident.spouses && resident.spouses.length > 0) {
        resident.spouses.forEach(function(spouse, index) {
          if (yPosition > pageHeight - 30) {
            doc.addPage();
            yPosition = margin;
          }
          doc.setFontSize(10);
          doc.setTextColor(139, 111, 90);
          doc.text('Spouse ' + (index + 1) + ':', margin, yPosition);
          yPosition += lineHeight;

          doc.setFontSize(9);
          doc.setTextColor(80, 80, 80);
          var spouseInfo = [
            ['Name:', spouse.name],
            ['Date of Birth:', spouse.dob],
            ['Gender:', spouse.gender],
            ['NID:', spouse.nid],
            ['Education:', spouse.education],
            ['Occupation:', spouse.occupation],
            ['Mobile:', spouse.mobile]
          ];

          spouseInfo.forEach(function(item) {
            if (yPosition > pageHeight - 20) {
              doc.addPage();
              yPosition = margin;
            }
            doc.text(item[0], margin + 5, yPosition);
            doc.text(item[1], margin + 35, yPosition);
            yPosition += lineHeight;
          });
          yPosition += 3;
        });
      }

      yPosition += 5;

      // Children Information Section
      doc.setFontSize(11);
      doc.setTextColor(139, 111, 90);
      doc.text('Children Information', margin, yPosition);
      yPosition += lineHeight + 2;

      doc.setFontSize(10);
      doc.setTextColor(80, 80, 80);
      doc.text('Number of Children: ' + resident.numChildren.toString(), margin, yPosition);
      yPosition += 10;

      if (resident.children && resident.children.length > 0) {
        resident.children.forEach(function(child, index) {
          if (yPosition > pageHeight - 30) {
            doc.addPage();
            yPosition = margin;
          }
          doc.setFontSize(10);
          doc.setTextColor(139, 111, 90);
          doc.text('Child ' + (index + 1) + ':', margin, yPosition);
          yPosition += lineHeight;

          doc.setFontSize(9);
          doc.setTextColor(80, 80, 80);
          var childInfo = [
            ['Name:', child.name],
            ['Date of Birth:', child.dob],
            ['Gender:', child.gender],
            ['Education:', child.education],
            ['Occupation:', child.occupation],
            ['Preferred Job:', child.preferredJob]
          ];

          childInfo.forEach(function(item) {
            if (yPosition > pageHeight - 20) {
              doc.addPage();
              yPosition = margin;
            }
            doc.text(item[0], margin + 5, yPosition);
            doc.text(item[1], margin + 35, yPosition);
            yPosition += lineHeight;
          });
          yPosition += 3;
        });
      }

      // Footer
      var now = new Date();
      var dateStr = now.toLocaleDateString('en-BD');
      doc.setFontSize(8);
      doc.setTextColor(150, 150, 150);
      doc.text('Generated on ' + dateStr, pageWidth / 2, pageHeight - 10, { align: 'center' });

      // Documents Section - Add images
      if (resident.birthCert || resident.deathCert || resident.marriageCert || 
          (resident.spouses && resident.spouses.some(function(s) { return s.marriageCert; })) ||
          (resident.children && resident.children.some(function(c) { return c.birthCert; }))) {
        doc.addPage();
        yPosition = margin;
        
        doc.setFontSize(14);
        doc.setTextColor(139, 111, 90);
        doc.text('Documents', margin, yPosition);
        yPosition += 12;
        
        // Helper function to load and add image
        function addDocumentImage(imagePath, label) {
          if (!imagePath) return false;
          
          try {
            // Create image element to get dimensions
            var img = new Image();
            img.src = imagePath;
            
            // For local files, we'll use try-catch and set a reasonable size
            doc.setFontSize(10);
            doc.setTextColor(80, 80, 80);
            doc.text(label + ':', margin, yPosition);
            yPosition += 8;
            
            // Add image with reasonable dimensions
            try {
              doc.addImage(imagePath, 'JPEG', margin + 5, yPosition, 60, 60);
              yPosition += 65;
            } catch(e) {
              doc.text('[Document image not available]', margin + 5, yPosition);
              yPosition += 8;
            }
            
            yPosition += 5;
            return true;
          } catch(e) {
            return false;
          }
        }
        
        // Add resident's birth certificate if exists
        if (resident.birthCert) {
          if (yPosition > pageHeight - 80) {
            doc.addPage();
            yPosition = margin;
          }
          addDocumentImage(resident.birthCert, 'Resident Birth Certificate');
        }
        
        // Add resident's death certificate if exists
        if (resident.deathCert) {
          if (yPosition > pageHeight - 80) {
            doc.addPage();
            yPosition = margin;
          }
          addDocumentImage(resident.deathCert, 'Resident Death Certificate');
        }
        
        // Add resident's marriage certificate if exists
        if (resident.marriageCert) {
          if (yPosition > pageHeight - 80) {
            doc.addPage();
            yPosition = margin;
          }
          addDocumentImage(resident.marriageCert, 'Resident Marriage Certificate');
        }
        
        // Add spouse documents
        if (resident.spouses && resident.spouses.length > 0) {
          resident.spouses.forEach(function(spouse, index) {
            if (spouse.marriageCert) {
              if (yPosition > pageHeight - 80) {
                doc.addPage();
                yPosition = margin;
              }
              addDocumentImage(spouse.marriageCert, 'Spouse ' + (index + 1) + ' Marriage Certificate');
            }
          });
        }
        
        // Add children documents
        if (resident.children && resident.children.length > 0) {
          resident.children.forEach(function(child, index) {
            if (child.birthCert) {
              if (yPosition > pageHeight - 80) {
                doc.addPage();
                yPosition = margin;
              }
              addDocumentImage(child.birthCert, 'Child ' + (index + 1) + ' Birth Certificate (' + child.name + ')');
            }
          });
        }
      }

      // Download PDF
      doc.save(resident.name + '_Resident_Report.pdf');
    });
  </script>
</body>
</html>
