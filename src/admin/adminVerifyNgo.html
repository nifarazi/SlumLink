<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SLUMLINK ¬∑ Verify NGOs</title>
  <link rel="stylesheet" href="adminSlumAnalytics.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="topbar">
    <div class="logo">SLUMLINK</div>
    <input type="text" placeholder="Search" class="search" />
    <div class="top-right">
      <span class="admin">Admin ‚ñæ</span>
      <a class="bell" href="adminNotification.html" title="Notifications">üîî</a>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <ul>
        <li><a href="adminSlumAnalytics.html">üìä Slum Analytics</a></li>
        <li><a href="adminNgoAnalytics.html">üìà NGO Analytics</a></li>
        <li><a href="adminSlumResidents.html">üè† Slum Residents</a></li>
        <li><a href="adminFieldAgents.html">üßë‚Äçüíº Field Agents</a></li>
        <li class="active"><a href="adminVerifyNgo.html">‚úî Verify NGOs</a></li>
      </ul>
    </aside>

    <main class="content">
      <div class="page-header">
        <div>
        </div>
      </div>

      <div class="table-card">
        <div class="card-header">
          <h2>Pending NGO Verifications</h2>
          
        </div>
        <div class="table-wrapper">
          <table class="pending-table">
            <thead>
              <tr>
                <th>Foundation Name</th>
                <th>Description</th>
                <th>Location</th>
                <th>Registration Document</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ngoTableBody">
              <!-- Rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Image Modal -->
  <div class="modal-overlay" id="imageModal" aria-hidden="true">
    <div class="image-modal" role="dialog" aria-modal="true">
      <button class="close-image-modal" id="closeImageModal" aria-label="Close">&times;</button>
      <img id="modalImage" src="" alt="Document preview">
      <div class="image-caption" id="imageCaption"></div>
      <button class="btn btn-primary" id="downloadImage" style="margin-top: 15px;">
        üì• Download Image
      </button>
    </div>
  </div>

  <!-- Approve Confirmation Modal -->
  <div class="modal-overlay" id="approveModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Approve NGO</div>
      <div class="modal-body" id="approveModalBody">Are you sure you want to approve this NGO?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelApprove">Cancel</button>
        <button class="btn btn-primary" id="confirmApprove">Approve</button>
      </div>
    </div>
  </div>

  <!-- Reject Confirmation Modal -->
  <div class="modal-overlay" id="rejectModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Reject NGO</div>
      <div class="modal-body" id="rejectModalBody">Are you sure you want to reject this NGO?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelReject">Cancel</button>
        <button class="btn btn-secondary" id="confirmReject">Reject</button>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal-overlay" id="successModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">Success</div>
      <div class="modal-body" id="successModalBody"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="closeSuccess">OK</button>
      </div>
    </div>
  </div>

  <!-- Logout Modal -->
  <div class="modal-overlay" id="logoutModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="logoutTitle">
      <div class="modal-header" id="logoutTitle">Log out</div>
      <div class="modal-body">You're currently signed in as Admin. Do you want to log out and return to the home page?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelLogout">Cancel</button>
        <button class="btn btn-primary" id="confirmLogout">Log out</button>
      </div>
    </div>
  </div>

  <script src="adminSlumAnalytics.js"></script>
  <script>
    var pendingNGOs = [
      { 
        name: 'Hope Foundation Bangladesh', 
        description: 'Providing education and healthcare services to underprivileged communities', 
        location: 'Dhaka, Bangladesh', 
        registrationDoc: 'profilepic/registrationCertificateNGO.jpg'
      },
      { 
        name: 'Green Earth Initiative', 
        description: 'Environmental awareness and sustainability programs for urban slums', 
        location: 'Chittagong, Bangladesh', 
        registrationDoc: 'profilepic/registrationCertificateNGO.jpg'
      },
      { 
        name: 'Women Empowerment Trust', 
        description: 'Skills training and livelihood support for women in slum areas', 
        location: 'Dhaka, Bangladesh', 
        registrationDoc: 'profilepic/registrationCertificateNGO.jpg'
      },
      { 
        name: 'Child Development Society', 
        description: 'Educational support and nutrition programs for children', 
        location: 'Sylhet, Bangladesh', 
        registrationDoc: 'profilepic/registrationCertificateNGO.jpg'
      },
      { 
        name: 'Community Health Network', 
        description: 'Healthcare services and medical camps in slum communities', 
        location: 'Dhaka, Bangladesh', 
        registrationDoc: 'profilepic/registrationCertificateNGO.jpg'
      }
    ];

    var currentApproveIndex = -1;
    var currentRejectIndex = -1;

    function renderRows() {
      var tbody = document.getElementById('ngoTableBody');
      tbody.innerHTML = '';

      pendingNGOs.forEach(function(ngo, index) {
        var row = document.createElement('tr');
        
        // Foundation Name
        var nameCell = document.createElement('td');
        nameCell.textContent = ngo.name;
        row.appendChild(nameCell);

        // Description
        var descCell = document.createElement('td');
        descCell.textContent = ngo.description;
        descCell.style.maxWidth = '300px';
        row.appendChild(descCell);

        // Location
        var locationCell = document.createElement('td');
        locationCell.textContent = ngo.location;
        row.appendChild(locationCell);

        // Registration Document
        var docCell = document.createElement('td');
        var docImg = document.createElement('img');
        docImg.src = ngo.registrationDoc;
        docImg.alt = 'Registration Certificate';
        docImg.className = 'doc-thumb';
        docImg.style.cursor = 'pointer';
        docImg.setAttribute('data-caption', 'Registration Certificate - ' + ngo.name);
        docImg.onclick = function() { openImageModal(ngo.registrationDoc, 'Registration Certificate - ' + ngo.name); };
        docCell.appendChild(docImg);
        row.appendChild(docCell);

        // Actions
        var actionsCell = document.createElement('td');
        actionsCell.className = 'pending-actions';
        
        var approveBtn = document.createElement('button');
        approveBtn.textContent = 'Approve';
        approveBtn.className = 'btn-approve';
        approveBtn.onclick = function() { 
          currentApproveIndex = index;
          openApproveModal(ngo.name);
        };
        
        var rejectBtn = document.createElement('button');
        rejectBtn.textContent = 'Reject';
        rejectBtn.className = 'btn-reject';
        rejectBtn.onclick = function() { 
          currentRejectIndex = index;
          openRejectModal(ngo.name);
        };
        
        actionsCell.appendChild(approveBtn);
        actionsCell.appendChild(rejectBtn);
        row.appendChild(actionsCell);
        
        tbody.appendChild(row);
      });

      if (pendingNGOs.length === 0) {
        var empty = document.createElement('tr');
        empty.innerHTML = '<td colspan="5" style="text-align:center;color:#8b6f5a;">No pending NGO verifications.</td>';
        tbody.appendChild(empty);
      }
    }

    function openImageModal(src, caption) {
      var modal = document.getElementById('imageModal');
      var img = document.getElementById('modalImage');
      var captionEl = document.getElementById('imageCaption');
      img.src = src;
      captionEl.textContent = caption || '';
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeImageModal() {
      var modal = document.getElementById('imageModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    }

    function openApproveModal(name) {
      var modal = document.getElementById('approveModal');
      var body = document.getElementById('approveModalBody');
      body.textContent = 'Are you sure you want to approve ' + name + '?';
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeApproveModal() {
      var modal = document.getElementById('approveModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
      currentApproveIndex = -1;
    }

    function openRejectModal(name) {
      var modal = document.getElementById('rejectModal');
      var body = document.getElementById('rejectModalBody');
      body.textContent = 'Are you sure you want to reject ' + name + '?';
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeRejectModal() {
      var modal = document.getElementById('rejectModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
      currentRejectIndex = -1;
    }

    function showSuccessModal(message) {
      var modal = document.getElementById('successModal');
      var body = document.getElementById('successModalBody');
      body.textContent = message;
      modal.setAttribute('aria-hidden', 'false');
      modal.classList.add('show');
    }

    function closeSuccessModal() {
      var modal = document.getElementById('successModal');
      modal.setAttribute('aria-hidden', 'true');
      modal.classList.remove('show');
    }

    document.getElementById('closeImageModal').addEventListener('click', closeImageModal);
    
    document.getElementById('imageModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeImageModal();
      }
    });

    document.getElementById('downloadImage').addEventListener('click', function() {
      var img = document.getElementById('modalImage');
      var caption = document.getElementById('imageCaption');
      var src = img.src;
      var fileName = caption.textContent.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.jpg';
      
      fetch(src)
        .then(function(response) { return response.blob(); })
        .then(function(blob) {
          var url = window.URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
        })
        .catch(function() { alert('Failed to download image'); });
    });

    document.getElementById('cancelApprove').addEventListener('click', closeApproveModal);
    
    document.getElementById('confirmApprove').addEventListener('click', function() {
      if (currentApproveIndex >= 0) {
        var approvedNGO = pendingNGOs[currentApproveIndex];
        pendingNGOs.splice(currentApproveIndex, 1);
        closeApproveModal();
        showSuccessModal(approvedNGO.name + ' has been approved successfully!');
        renderRows();
      }
    });

    document.getElementById('approveModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeApproveModal();
      }
    });

    document.getElementById('cancelReject').addEventListener('click', closeRejectModal);
    
    document.getElementById('confirmReject').addEventListener('click', function() {
      if (currentRejectIndex >= 0) {
        var rejectedNGO = pendingNGOs[currentRejectIndex];
        pendingNGOs.splice(currentRejectIndex, 1);
        closeRejectModal();
        showSuccessModal(rejectedNGO.name + ' has been rejected.');
        renderRows();
      }
    });

    document.getElementById('rejectModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeRejectModal();
      }
    });

    document.getElementById('closeSuccess').addEventListener('click', closeSuccessModal);

    document.getElementById('successModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeSuccessModal();
      }
    });

    renderRows();
  </script>
</body>
</html>
